{%  extends "base.html" %}

{% block content %}

<div class="row">
    <div class="col-xl-12">
        <div class="alert alert-primary alert-dismissable fade show" role="alert">
                <h3 class="alert-heading">Disclaimer</h3>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>

                <p class="justify-content-between">
                    This is a rough model based on preliminary data. It might not be entirely accurate.
                    It is a very simple model. Please be aware when using.

                    Made by: Akansha, Jeffrey, Johan, Ludovica, Malvika, Martin, Srija
                </p><hr>
        </div>
    </div>
    <div class="col-xl-12">
        <div class="card mb-4">
            <div class="card-header"><i class="fas fa-chart-area mr-1"></i>Chart of Infection for {{ country or None}}</div>
            <div class="card-body">
                <div class="container">
                  <div class="row">
                    <div class="col-sm-5">
                      <div>


                    <form class="form-horizontal">
                        <fieldset>

                        <!-- Form Name -->
                        <legend>Apply A Regulation</legend>

                        <!-- Select Basic -->
                        <div class="form-group">
                          <label class="col-md-4 control-label" for="geo-area">Geographic Area:</label>
                          <div class="col-md-5">
                            <select id="geo-area" name="geo-area" class="form-control">
                              <option value="1">Option one</option>
                              <option value="2">Option two</option>
                            </select>
                          </div>
                        </div>


                        <!-- Select Basic -->
                        <div class="row no-gutters">
                        <div class="col-sm-6">
                            {% for n in range(13) %}
                                {%   if n%2 ==0 %}



                        <div class="form-group">
                            <label class="control-label" for="agg-emergency">{{ fields[n][1] }}:</label>
                            <div class="col-md-5">
                                <select id="{{ fields[n][0] }}" name="{{ fields[n][0] }}" class="form-control">
                                    <option value="1">Not Applied</option>
                                    <option value="2">50%</option>
                                    <option value="3">100%</option>
                                </select>
                            </div>
                        </div>

                        {% endif %}

                            {% endfor %}
                        </div>
                        <div class="col-sm-6">
                             {% for n in range(13) %}
                                {%  if n%2 == 1 %}



                        <div class="form-group">
                            <label class="control-label" for="agg-emergency">{{ fields[n][1] }}:</label>
                            <div class="col-md-5">
                                <select id="{{ fields[n][0] }}" name="{{ fields[n][0] }}" class="form-control">
                                    <option value="1">Not Applied</option>
                                    <option value="2">50%</option>
                                    <option value="3">100%</option>
                                </select>
                            </div>
                        </div>

                        {% endif %}

                            {% endfor %}
                                </div>
                        </div>

                    <!-- Button -->
                    <div class="form-group">
                      <label class="col-md-4 control-label" for="apply">Submit:</label>
                      <div class="col-md-4">
                        <button id="apply" name="apply" class="btn btn-primary">Apply</button>
                      </div>
                    </div>

                    </fieldset>
                    </form>

                </div>
                    </div>
                    <div class="col-sm-7">
                        <legend>Model of Infection Rate</legend>
                      <div class="chart" id="bargraph">

                            <script>
                                var graphs = {{plot | safe}};
                                Plotly.plot('bargraph',graphs,{});
                            </script>
                        </div>
                    </div>
                  </div>
                </div>


            </div>
        </div>
    </div>
    <div class="col-xl-12">
        <div class="card mb-4">
            <div class="card-header"><i class="fas fa-chart-area mr-1"></i>Regulations Enacted for {{ country or None }}</div>
            <div class="card-body">
                <div class="table-responsive">
                                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
{#                                                ['Source', 'descriptions', 'titles', 'dates',#}
{#               'locations_identified_titles','latlon_titles',#}
{#               'new_case_highest-N-text_extract',#}
{#               'acc_case_highest-N-text_extract']#}
                                                <th>Source</th>
                                                <th>Title</th>
                                                <th>Description</th>
                                                <th>Dates</th>
                                                <th>Identified Locations</th>
                                                <th>Identified New Cases</th>
                                                <th>Identified Accumulated Cases</th>
                                            </tr>
                                        </thead>
                                        <tfoot>
                                            <tr>
                                                <th>Source</th>
                                                <th>Title</th>
                                                <th>Description</th>
                                                <th>Dates</th>
                                                <th>Identified Locations</th>
                                                <th>Identified New Cases</th>
                                                <th>Identified Accumulated Cases</th>
                                            </tr>
                                        </tfoot>
                                        <tbody>
                                        {% if table %}
{#                                        {%  for index, row in table %}#}
{#                                            <tr>#}
{#                                                <td>{{ row["Source"] }}</td>#}
{#                                                <td>{{ row["titles"] }}</td>#}
{#                                                <td>{{ row["descriptions"] }}</td>#}
{#                                                <td>{{ row["dates"] }}</td>#}
{#                                                <td>{{ row["locations_identified_titles"] }}</td>#}
{#                                                <td>{{ row["new_case_highest-N-text_extract"] }}</td>#}
{#                                                <td>{{ row["acc_case_highest-N-text_extract"] }} <br>#}
{#                                                    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#details-{{ index }}">#}
{#                                                      Details#}
{#                                                    </button>#}
{#                                                </td>#}
{#                                            </tr>#}
{#                                        {%  endfor %}#}
                                        {% endif %}
                                        </tbody>
                                    </table>
            </div>
        </div>
    </div>
</div>

    {%  if table %}
{% for index, row in table.iterrows() %}

    <!-- Modal -->
    <div class="modal fade" id="details-{{ index }}" tabindex="-1" role="dialog"  aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">{{ row["titles"] }}</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p><strong>Description: </strong> {{ row["descriptions"] }}</p>
                    <p><strong>Identified Locations in Title: </strong> {% for loc in row["locations_identified_titles"] %}{{ loc }}, {% endfor %}</p>
                    <p><strong>Identified Locations in Description: </strong> {% for loc in row["locations_identified_descriptions"] %}{{ loc }}, {% endfor %}</p>
                    <p><strong>Identified Accumulated Case:</strong> {{ row["acc_case_highest-N-text_extract"] }}
                        <span class="badge badge-warning">(Prob. {{ (100*row['acc_case_highest-N-prob'])|round(2) }} %)</span> <br>
                    From text: {{ row['acc_case_highest-I-text'] }}</p>
                    <p><strong>Identified New Case:</strong> {{ row["new_case_highest-N-text_extract"]}}
                        <span class="badge badge-warning">(Prob. {{ (100*row['new_case_highest-N-prob'])|round(2) }} %)</span> <br>
                    From text: {{ row['new_case_highest-I-text'] }}</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary">Save changes</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

{% endfor%}
    {% endif %}

{%  endblock %}

